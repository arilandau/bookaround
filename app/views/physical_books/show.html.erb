<%= content_for(:title) do %>
Bookaround | <%= @book.title %>
<% end %>

<div class="container">
  <div class="row">
    <div class="col-xs-12 col-md-3">
      <div class="row">
        <div class="col-xs-6 col-md-3">
          <%= image_tag "#{@book.cover_pic_url}", {class: "img-responsive" }   %>
        </div>
        <div class="col-xs-6 col-md-3">
          <a href="#" class="thumbnail" >
          <%= image_tag "#{@book.picture_url}", {class: "img-responsive" }   %>
          </a>
        </div>
      </div>
    </div>
    <div class="col-xs-12 col-md-9">
      <h2><%= @book.title %></h2>
      <h3><%= @book.author %></h3>
    <h3><%= link_to Genre.find(@book.genre_id).name, genre_path(@book.genre_id) %></h3>
<%#= Genre.find(@book.genre_id).name %>
      <p class="card-book-summary"><%= @book.description %></p>
      <div>
        <% if current_user %>
          <% unless current_user.coordinates[0].nil? || @book.user == current_user%>
            <p>
              <%= current_user.distance_from(@book.user_coordinates).round(2) %> km away.
            </p>
          <% end %>
        <% end %>
      </div>


      <% if current_user == PhysicalBook.find(params[:id]).user %>
        <%= link_to "Update Book", edit_physical_book_path(@book), {class: "btn btn-primary"} %>

        <%= link_to "Delete Book", physical_book_path(@book), class: "btn btn-primary", method: :delete, data: {confirm: "Are you sure you want to delete this book?"} %>
      <% end %>
      <% if current_user != PhysicalBook.find(params[:id]).user %>
        <%=link_to(user_path(@book.user)) do %>
        <div class="card-book-summary flex-center-two">
          <div>
            <%= image_tag "#{@book.user.profile_pic_url}", class: "avatar-md" %>
          </div>
        <% end %>
        <%= link_to new_message_path(to: @book.user, book: @book, recipient: @book.user) do %>
        <i class="fa fa-envelope fa-2x"></i>

        <% end %>
      <% end %>
        </div>
    </div>
  </div>
  <% unless current_user == @book.user %>
    <div id="map" style="width: 100%; height: 385px;">
    </div>
    <% content_for(:after_js) do %>

    <script type="text/javascript">
      $(document).on('ready', function() {
        var handler = Gmaps.build('Google');

        var mapOptions = {
          center: new google.maps.LatLng(<%=@book.user.latitude %>,<%=@book.user.longitude %>),
          zoom: 10
        };
        handler.buildMap({ provider: mapOptions, internal: { id: 'map' } }, function(){
          markers = handler.addMarkers(<%= raw @hash.to_json %>);

        });
      });
    </script>
    <% end %>
  <% end %>
</div>
